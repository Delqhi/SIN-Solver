# Session 20 - Skyvern+Steel Integration Architecture

**Session ID:** ses_20_skyvern_steel_arch_20260130  
**Datum:** 2026-01-30  
**Projekt:** /Users/jeremy/dev/SIN-Solver  
**Agent:** sisyphus  
**Status:** âœ… COMPLETED  

---

## ğŸ¯ OBJECTIVE

Planung und Architektur fÃ¼r die Integration von **Skyvern (Visual AI)** + **Steel Browser (CDP)** in Scira, um authentifiziertes Web-Scraping zu ermÃ¶glichen.

---

## âœ… COMPLETED TASKS

### 1. Scira MCP & Container Analyse
- **Status:** âœ… COMPLETED
- **Ergebnis:** Scira ist korrekt in OpenCode CLI konfiguriert, Container wird gebaut
- **Files:** `~/.config/opencode/opencode.json`

### 2. OpenHands MCP Konfiguration
- **Status:** âœ… COMPLETED
- **Aktion:** OpenHands als MCP in opencode.json hinzugefÃ¼gt
- **Wichtig:** Container NICHT gestartet (Ressourcenfresser: 4GB RAM)
- **Files Modified:** `~/.config/opencode/opencode.json`

### 3. API Kosten Analyse
- **Status:** âœ… COMPLETED
- **Ergebnisse:**
  - Exa: ğŸ’° $49-449/Monat (NICHT free)
  - Tavily: ğŸ’° Freemium (1,000 free/month)
  - TMDB: ğŸ†“ FREE
  - OpenWeather: ğŸ’° Freemium (1,000 req/Tag)
  - OpenCode Zen: ğŸ†“ FREE (nur in OpenCode CLI!)

### 4. Stagehand vs Skyvern vs Vercel Agent Vergleich
- **Status:** âœ… COMPLETED
- **Gewinner:** ğŸ† **Skyvern** - Best fÃ¼r Auth, FREE, bereits deployed
- **Location:** `agent-06-skyvern-solver` (Port 8030)

### 5. Skyvern+Steel Integration Architektur
- **Status:** âœ… COMPLETED
- **Ergebnis:** VollstÃ¤ndige Architektur mit:
  - AuthScrapingService (Orchestrierung)
  - SkyvernClient (Visual AI)
  - SteelClient (CDP Session Management)
  - API Routes
  - Redis Session Storage
  - Vault Credential Storage

### 6. Dokumentation
- **Status:** âœ… COMPLETED
- **Files Created:**
  - `~/.config/opencode/AGENTS.md` (erweitert)
  - `/Users/jeremy/dev/SIN-Solver/.memory/scira-skyvern-steel-architecture`

---

## ğŸ“Š KEY DECISIONS

### Architektur-Entscheidungen

| Entscheidung | Grund |
|--------------|-------|
| **Skyvern als Primary** | Beste Auth-UnterstÃ¼tzung (2FA/TOTP), Visual AI, FREE |
| **Steel fÃ¼r Sessions** | CDP, Cookie Management, Stealth Mode |
| **Externe Services** | Scira bleibt schlank, Services separat skalierbar |
| **Redis fÃ¼r Sessions** | 24h TTL, automatische AufrÃ¤umung |
| **Vault fÃ¼r Credentials** | Sichere Speicherung, verschlÃ¼sselt |

### Technologie-Stack

```
Scira Container
â”œâ”€â”€ AuthScrapingService (TypeScript)
â”‚   â”œâ”€â”€ SkyvernClient â†’ agent-06:8030
â”‚   â”œâ”€â”€ SteelClient â†’ agent-05:3005
â”‚   â””â”€â”€ AuthManager â†’ Vault + Redis
â””â”€â”€ API Routes
    â””â”€â”€ /api/auth-scraping/*
```

---

## ğŸ”§ ARCHITECTURE OVERVIEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SCIRA AUTHENTICATED SCRAPING                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        SCIRA CONTAINER                              â”‚   â”‚
â”‚  â”‚                     (Next.js + API Routes)                          â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  Public Search  â”‚  â”‚  Auth Scraping  â”‚  â”‚   Session Mgmt  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚   (Exa/Tavily)  â”‚  â”‚   (Skyvern+Steel)â”‚  â”‚   (Redis/DB)    â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              AuthScrapingService (TypeScript)               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ SkyvernClientâ”‚  â”‚ SteelClient  â”‚  â”‚ AuthManager  â”‚      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  (Visual AI) â”‚  â”‚  (CDP/Session)â”‚  â”‚ (Credentials)â”‚      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â”‚ HTTP API                                â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     EXTERNAL SERVICES                               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚   Skyvern Solver         â”‚      â”‚   Steel Browser          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚   (agent-06:8030)        â”‚      â”‚   (agent-05:3005)        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                          â”‚      â”‚                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Visual AI Analysis    â”‚      â”‚  â€¢ CDP Connection        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Login Form Detection  â”‚      â”‚  â€¢ Session Persistence   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CAPTCHA Solving       â”‚      â”‚  â€¢ Cookie Management     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ 2FA/TOTP Handling     â”‚      â”‚  â€¢ Stealth Mode          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Coordinate Extraction â”‚      â”‚  â€¢ Screenshot Capture    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                    â”‚                                â”‚   â”‚
â”‚  â”‚                                    â”‚ WebSocket                      â”‚   â”‚
â”‚  â”‚                                    â–¼                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              Target Website (Authenticated)                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                   (LinkedIn, Xing, etc.)                    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ IMPLEMENTATION PLAN

### Phase 1: Core Integration (Woche 1)
- [ ] `lib/services/skyvern-client.ts` erstellen
- [ ] `lib/services/steel-client.ts` erweitern
- [ ] `lib/services/auth-scraping-service.ts` erstellen
- [ ] Redis Schema fÃ¼r Sessions definieren

### Phase 2: API Routes (Woche 2)
- [ ] `app/api/auth-scraping/route.ts` implementieren
- [ ] `app/api/auth-scraping/session/route.ts` (Session Management)
- [ ] `app/api/auth-scraping/credentials/route.ts` (Credential Storage)
- [ ] Error Handling & Logging

### Phase 3: UI Integration (Woche 3)
- [ ] Auth-Scraping Dialog in Scira UI
- [ ] Credential Manager Interface
- [ ] Session Viewer (aktive Sessions anzeigen)
- [ ] 2FA Input Dialog

### Phase 4: Testing & Optimization (Woche 4)
- [ ] E2E Tests mit Test-Websites
- [ ] Performance Optimierung
- [ ] Security Audit
- [ ] Dokumentation

---

## ğŸ” RESEARCH FINDINGS

### Warum Skyvern > Stagehand > Vercel Agent

| Feature | Skyvern | Stagehand | Vercel Agent |
|---------|---------|-----------|--------------|
| **2FA/TOTP Support** | âœ… Built-in | âŒ Nein | âŒ Nein |
| **CAPTCHA Solving** | âœ… Visueller AI | âŒ Nein | âš ï¸ Basic |
| **Kosten** | ğŸ†“ FREE | ğŸ’° Paid | ğŸ†“ FREE |
| **Session Persistence** | âœ… Ja | âœ… Ja | âœ… Ja |
| **Credential Management** | âœ… Vault Integration | âŒ Nein | âŒ Nein |
| **Proxy Support** | âœ… Ja | âœ… Ja | âŒ Nein |
| **Computer Vision** | âœ… Ja | âŒ Nein | âŒ Nein |
| **API Endpoint** | âœ… Ja | âŒ CLI | âŒ CLI |

### OpenCode Zen in Scira = NICHT MÃ–GLICH

**Wichtige Erkenntnis:**
- OpenCode Zen Modelle (`kimi-k2.5-free`, `big-pickle`, `glm-4.7-free`) sind **NUR innerhalb OpenCode CLI** verfÃ¼gbar
- Scira ist ein **Standalone Next.js Container** mit eigenem Backend
- Scira nutzt die **Vercel AI SDK** direkt, nicht OpenCode's Provider-System
- Daher: Scira kann OpenCode Zen **NICHT** nutzen

---

## ğŸ“š FILES MODIFIED / CREATED

### Konfiguration
- `~/.config/opencode/opencode.json` - OpenHands MCP hinzugefÃ¼gt
- `~/.config/opencode/AGENTS.md` - Architektur-Dokumentation erweitert

### Dokumentation
- `/Users/jeremy/dev/SIN-Solver/.memory/scira-skyvern-steel-architecture` - VollstÃ¤ndige Architektur

### Bestehende Services (bereits deployed)
- `agent-05-steel-browser` (Port 3005) - LÃ¤uft âœ…
- `agent-06-skyvern-solver` (Port 8030) - LÃ¤uft âœ…

---

## ğŸ¯ NEXT STEPS

1. **Scira Container Build** abwarten (lÃ¤uft noch)
2. **TypeScript Clients** implementieren (SkyvernClient, SteelClient)
3. **AuthScrapingService** entwickeln
4. **API Routes** erstellen
5. **Mit bestehenden Services testen**

---

## ğŸ”— REFERENCES

- **Skyvern Client:** `/Users/jeremy/dev/SIN-Solver/app/services/skyvern_client.py`
- **Steel Client:** `/Users/jeremy/dev/SIN-Solver/integrations/steel-client.ts`
- **Architektur Memory:** `/Users/jeremy/dev/SIN-Solver/.memory/scira-skyvern-steel-architecture`
- **Globale AGENTS.md:** `~/.config/opencode/AGENTS.md`

---

## ğŸ“Š MANDATE COMPLIANCE

| Mandate | Status |
|---------|--------|
| MANDATE 0.0 (Immutability) | âœ… Keine Inhalte gelÃ¶scht |
| MANDATE -7 (Session Docs) | âœ… Diese Datei erstellt |
| MANDATE -8 (Sub-Agent Context) | âœ… Alle Agenten informiert |
| MANDATE 0.13 (CEO Workspace) | âœ… Struktur befolgt |
| MANDATE 0.33 (Docker as MCP) | âœ… Wrapper Pattern dokumentiert |

---

**Session completed:** 2026-01-30 22:55  
**Total Duration:** ~2.5 hours  
**Status:** âœ… ARCHITECTURE READY FOR IMPLEMENTATION
