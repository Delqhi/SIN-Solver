# VNC Browser Service for Delqhi-Platform
# Provides HEADFULL Chrome with VNC access
# Alternative to headless Steel Browser

services:
  agent-05-vnc-browser:
    image: mrcolorr/vnc-browser:latest
    container_name: agent-05-vnc-browser
    hostname: agent-05-vnc-browser
    ports:
      # VNC Display (Remote Desktop)
      - "${VNC_BROWSER_PORT:-5900}:5900"
      # noVNC Web Interface (Browser-based VNC)
      - "${VNC_WEB_PORT:-5901}:6901"
      # Chrome DevTools Protocol (CDP)
      - "${VNC_CDP_PORT:-50015}:9222"
      # Optional: HTTP API if available
      - "${VNC_API_PORT:-50005}:3000"
    environment:
      # VNC Configuration
      - VNC_PW=${VNC_PASSWORD:-delqhi-admin}
      - VNC_RESOLUTION=${VNC_RESOLUTION:-1920x1080}
      - VNC_COL_DEPTH=${VNC_COL_DEPTH:-24}
      
      # Chrome Configuration
      - CHROME_ARGS=--remote-debugging-address=0.0.0.0 --remote-debugging-port=9222 --no-sandbox --disable-dev-shm-usage
      
      # Display settings
      - DISPLAY=:1
      
      # Agent Identification
      - AGENT_NAME=agent-05-vnc-browser
      - AGENT_ID=05-vnc
      - AGENT_ROLE=browser-automation-headfull
      - AGENT_VERSION=1.0.0
      
      # Mode: headfull (visible) or headless
      - BROWSER_MODE=headfull
      
    volumes:
      # Persistent Chrome data
      - vnc-browser-data:/home/user/data
      # Downloads folder
      - vnc-browser-downloads:/home/user/Downloads
      # Custom scripts
      - ./scripts:/home/user/scripts:ro
      
    networks:
      - sin-solver-network
      
    restart: unless-stopped
    
    healthcheck:
      test:
        - CMD
        - curl
        - -f
        - http://localhost:9222/json/version
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
      
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
        labels: "service=agent-05-vnc-browser"
        
    labels:
      - "com.delqhi.service=agent"
      - "com.delqhi.agent-number=05-vnc"
      - "com.delqhi.agent-role=browser-automation-headfull"
      - "com.delqhi.browser-mode=headfull"
      - "com.delqhi.vnc-enabled=true"
      - "com.delqhi.version=1.0"

volumes:
  vnc-browser-data:
    driver: local
  vnc-browser-downloads:
    driver: local

networks:
  sin-solver-network:
    external: true
    name: sin-solver-network
