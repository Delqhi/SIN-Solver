# agent-01-n8n-orchestrator: Workflow Automation
# Best Practices 2026: Modular Architecture


services:
  agent-01-n8n-orchestrator:
    image: n8nio/n8n:latest
    platform: linux/arm64  # Mac M1 native support
    container_name: agent-01-n8n-orchestrator
    hostname: agent-01-n8n-orchestrator
    environment:
      NODE_ENV: production
      N8N_BASIC_AUTH_ACTIVE: "true"
      N8N_BASIC_AUTH_USER: ${N8N_USER:-admin}
      N8N_BASIC_AUTH_PASSWORD: ${N8N_PASSWORD:-admin}
      WEBHOOK_URL: https://n8n.delqhi.com/
      GENERIC_TIMEZONE: Europe/Berlin
      EXECUTIONS_MODE: regular
      EXECUTIONS_TIMEOUT: 300
      EXECUTIONS_TIMEOUT_MAX: 3600
      DB_TYPE: postgresdb
      DB_POSTGRESDB_HOST: room-03-postgres-master
      DB_POSTGRESDB_PORT: 5432
      DB_POSTGRESDB_DATABASE: n8n
      DB_POSTGRESDB_USER: ${N8N_DB_USER:-n8n}
      DB_POSTGRESDB_PASSWORD: ${N8N_DB_PASSWORD:-n8n_password}
    ports:
      - "5678:5678"
    volumes:
      - n8n_data:/home/node/.n8n
    networks:
      - sin-solver-network
    depends_on:
      room-03-postgres-master:
        condition: service_healthy
      room-04-redis-cache:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:5678/healthz"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "5"

volumes:
  n8n_data:
    driver: local

networks:
  sin-solver-network:
    external: true
    name: sin-solver-network
