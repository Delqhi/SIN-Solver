version: '3.9'

services:
  agent-06-skyvern-solver:
    image: skyvern:latest
    container_name: agent-06-skyvern-solver
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8030:8000"
    environment:
      - PYTHONUNBUFFERED=1
      - SKYVERN_LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@room-03-postgres-master:5432/${DB_NAME}
      - REDIS_URL=redis://room-04-redis-cache:6379
      - AGENT_NAME=agent-06-skyvern
      - AGENT_ID=06
      - AGENT_ROLE=visual-task-solving
      - AGENT_VERSION=1.0.0
      - VISION_MODEL=${VISION_MODEL:-gpt-4-vision}
      - VISION_API_KEY=${VISION_API_KEY}
      - MAX_CONCURRENT_TASKS=${AGENT_06_MAX_TASKS:-5}
      - TASK_TIMEOUT=${AGENT_06_TASK_TIMEOUT:-120}
      - LLM_PROVIDER=${LLM_PROVIDER:-openai}
      - PLAYWRIGHT_BROWSERS_PATH=/root/.cache/ms-playwright
    depends_on:
      room-03-postgres-master:
        condition: service_healthy
      room-04-redis-cache:
        condition: service_healthy
    networks:
      - sin-solver-network
    volumes:
      - agent-06-data:/app/data
      - agent-06-cache:/root/.cache/ms-playwright
      - agent-06-screenshots:/app/screenshots
    restart: unless-stopped
    healthcheck:
      test:
        - CMD
        - curl
        - -f
        - http://localhost:8000/health
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 50s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
        labels: "service=agent-06-skyvern"
    labels:
      - "com.sin-solver.service=agent"
      - "com.sin-solver.agent-number=06"
      - "com.sin-solver.agent-role=visual-task-solving"
      - "com.sin-solver.version=1.0"

volumes:
  agent-06-data:
    driver: local
  agent-06-cache:
    driver: local
  agent-06-screenshots:
    driver: local

networks:
  sin-solver-network:
    external: true
    name: sin-solver-network
