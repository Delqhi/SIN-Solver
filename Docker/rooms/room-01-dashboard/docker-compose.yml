
services:
  room-01-dashboard-cockpit:
    build:
      context: ../../../dashboard
      dockerfile: Dockerfile
    image: sin-solver/dashboard:local
    container_name: room-01-dashboard-cockpit
    environment:
      NODE_ENV: production
      DATABASE_URL: postgresql://${DB_USER:-postgres}:${DB_PASSWORD:-sinsolveradmin}@room-03-postgres-master:5432/${DB_NAME:-sin_solver_prod}
      REDIS_URL: redis://:${REDIS_PASSWORD:-sinsolveradmin}@room-04-redis-cache:6379
      API_HOST: http://room-01-dashboard-cockpit:3011
      N8N_HOST: http://agent-01-n8n-orchestrator:5678
      NEXT_PUBLIC_API_URL: https://sin-solver-dashboard.vercel.app/api
      NEXT_PUBLIC_WS_URL: wss://sin-solver-dashboard.vercel.app
    volumes:
       - /var/run/docker.sock:/var/run/docker.sock
    ports:
       - "${DASHBOARD_PORT:-3011}:3011"
    networks:
      - sin-solver-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3011/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

networks:
  sin-solver-network:
    external: true
    name: sin-solver-network
